Date: Mon, 26 Oct 1998 15:14:04 -0500                                   
From: Mario Dupuis <Mario.Dupuis@mfg.canadair.ca>                

I've take some tips from the FAQ about permitting only certain users
to send to external mail and came up with my own for the receiving part.

[I have modified this to cope with the case of a null sender. PH]

#
# Transports
#
reject_remote_user:
  driver        = autoreply
  file          = /etc/exim/err_messages/reject_remote_user.txt
  file_expand
  user          = exim
  group         = exim
  from          = postmaster@${domain}
  to            = $sender_address
  subject       = "Re: Your mail to ${local_part}@${domain}"

#
# Directors
#
localuser:
  driver = localuser
  transport = local_delivery
  condition = "${if eq{$sender_address}{}{yes}\
    {${lookup{$sender_address_domain}lsearch{/exim/perm/domains}{yes}}}}"

localuser_from_external:
  driver = localuser
  transport = local_delivery
  condition ="${lookup{$local_part}lsearch{/exim/permitted/receivers}{yes}}"

localuser_from_external_bounce:
  driver = smartuser
  transport = reject_remote_user
  no_verify
  unseen

#
# Routers
#
internal_delivery:
  driver = domainlist
  route_list = "*our_domain.com  $domain  bydns_mx;\
                *our_friend.com  $domain  bydns_mx;\
  transport = remote_smtp

external_delivery:
        driver = domainlist
        route_list = "*  internet-gateway.com  bydns_a"
        transport = remote_smtp
        require_files = /etc/exim/permitted/senders
        senders = ":\
          ^[^@]+@(?!${rxquote:our_domain.com}\\$):\
          lsearch;/etc/exim/permitted/senders"

